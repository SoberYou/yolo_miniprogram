<!-- pages/index/index.wxml -->
<view class="container">
  <!-- Custom Header -->
  <view class="custom-header" style="height: {{navBarHeight}}px; padding-top: {{statusBarHeight}}px;">
    <view class="header-content" style="height: {{menuButtonHeight}}px; line-height: {{menuButtonHeight}}px;">
      <text class="app-title">YOU ONLY LIVE ONCE</text>
      <!-- User Icon - Positioned absolute or flex to not overlap title -->
      <view class="user-icon-container" bindtap="goToUser">
         <view class="user-icon"></view>
      </view>
    </view>
  </view>

  <!-- Main Content -->
  <scroll-view scroll-y class="main-content" style="padding-top: {{navBarHeight}}px;">
    
    <!-- A Zone: Life Time -->
    <view class="section-life" bindtap="goToLife" >
      <view class="life-bar-container">
         <view class="life-bar-fill" style="width: {{lifeTime.usedPercentage}}"></view>
         <view class="life-bar-empty"></view>
      </view>
      <view class="life-info">
        <view class="life-text-group">
          <text class="life-label">你的人生，现在是</text>
          <text class="life-time">{{lifeTime.currentTime}}</text>
        </view>
        <view class="life-stats">
          <text>已用 {{lifeTime.usedPercentage}}</text>
          <text class="separator">|</text>
          <text>剩余 {{lifeTime.leftPercentage}}</text>
        </view>
      </view>
    </view>

    <!-- B Zone: North Star List -->
    <view class="section-header-b">
      <text class="section-title">北极星列表</text>
      <view class="add-btn" bindtap="openAddGoalModal">+</view>
    </view>

    <!-- Modal for Adding Goal -->
    <page-container show="{{showAddGoalModal}}" position="center" round overlay custom-style="background-color: transparent;">
      <view class="modal-overlay">
        <view class="modal-content">
          <view class="modal-header">新增目标</view>
          
          <view class="form-item">
            <input class="modal-input" placeholder="目标名称 (Title)" bindinput="handleTitleInput" value="{{newGoal.title}}" />
          </view>
          
          <view class="form-item">
            <textarea class="modal-textarea" placeholder="描述 (Description)" bindinput="handleDescriptionInput" value="{{newGoal.description}}" />
          </view>
          
          <view class="form-item">
            <input class="modal-input" type="number" placeholder="预期投入小时数" bindinput="handleHoursInput" value="{{newGoal.expected_total_hours}}" />
          </view>
          
          <view class="form-item category-selection">
            <text class="category-label">北极星</text>
            <view class="category-chips">
              <block wx:for="{{categories}}" wx:key="*this">
                <view 
                  class="category-chip {{newGoal.north_star === item ? 'selected' : ''}}" 
                  bindtap="selectCategory" 
                  data-value="{{item}}"
                >
                  {{item}}
                </view>
              </block>
            </view>
          </view>
          
          <view class="modal-actions">
            <button class="modal-btn cancel" bindtap="closeAddGoalModal">取消</button>
            <button class="modal-btn confirm" bindtap="submitGoal">确认添加</button>
          </view>
        </view>
      </view>
    </page-container>

    <!-- GOAL Zone -->
    <view class="section-goals">
      <view class="goals-list-wrapper" style="{{goals.length > 3 ? 'height: 260px; overflow-y: auto;' : ''}}">
        <block wx:for="{{goals}}" wx:key="id">
          <view class="goal-card" bindtap="goToGoal" data-id="{{item.id}}">
            <view class="goal-name">{{item.name}}</view>
            <view class="goal-time">{{item.timeSpent}}</view>
          </view>
        </block>
      </view>
    </view>

    <!-- CTA Zone -->
    <view class="section-cta">
      <view class="cta-header">今天只需要做一件事</view>
      <view class="cta-suggestion">{{cta.suggestion}}</view>
      
      <view class="cta-actions">
        <button class="btn-start" bindtap="startFocus">开始</button>
        <button class="btn-skip" bindtap="handleSkip">今天不做</button>
      </view>
    </view>

    <!-- Footer Padding -->
    <view style="height: 40px;"></view>

  </scroll-view>
</view>
