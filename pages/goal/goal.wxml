<!-- pages/goal/goal.wxml -->
<view class="container">
  <!-- Custom Header -->
  <view class="custom-header" style="height: {{navBarHeight}}px; padding-top: {{statusBarHeight}}px;">
    <view class="header-content" style="height: {{menuButtonHeight}}px; line-height: {{menuButtonHeight}}px;">
      <view class="back-btn" bindtap="goBack">
        <view class="back-arrow"></view>
      </view>
      <text class="page-title">{{goal.name}}</text>
    </view>
  </view>

  <!-- Main Content -->
  <scroll-view scroll-y class="main-content" style="padding-top: {{statusBarHeight}}px;">
    
    <!-- Title & Description -->
    <view class="section-header">
      <view class="goal-title">{{goal.name}}</view>
      <view class="goal-desc-group">
        <text class="goal-desc">你以为你想要它</text>
        <text class="goal-desc sub">这是最近的数据</text>
      </view>
    </view>

    <!-- Time Investment Stats -->
    <view class="section-stats">
      <view class="stat-card">
        <text class="stat-label">近 7 天</text>
        <text class="stat-value">{{goal.stats.last7Days}}</text>
      </view>
      <view class="stat-card">
        <text class="stat-label">近 30 天</text>
        <text class="stat-value">{{goal.stats.last30Days}}</text>
      </view>
    </view>

    <!-- History List (Heatmap) -->
    <view class="section-history">
      <view class="history-label">专注分布</view>
      
      <view class="heatmap-container">
        <!-- Left Labels (Mon-Sun) -->
        <view class="weekday-labels">
          <text class="weekday-label">1</text>
          <text class="weekday-label">2</text>
          <text class="weekday-label">3</text>
          <text class="weekday-label">4</text>
          <text class="weekday-label">5</text>
          <text class="weekday-label">6</text>
          <text class="weekday-label">7</text>
        </view>

        <!-- Scrollable Heatmap -->
        <scroll-view scroll-x class="heatmap-scroll" scroll-left="{{scrollLeft}}">
          <view class="heatmap-content">
            <!-- Month Labels -->
            <view class="months-row">
              <block wx:for="{{goal.heatmap}}" wx:key="index">
                <view class="month-col">
                  <text class="month-text" wx:if="{{item.month}}">{{item.month}}</text>
                </view>
              </block>
            </view>

            <!-- Grid -->
            <view class="weeks-row">
              <block wx:for="{{goal.heatmap}}" wx:key="index" wx:for-item="week">
                <view class="week-col">
                  <block wx:for="{{week.days}}" wx:key="date" wx:for-item="day">
                    <view class="day-cell level-{{day.level}}"></view>
                  </block>
                </view>
              </block>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- Legend -->
      <view class="heatmap-legend">
        <text class="legend-text">Less</text>
        <view class="legend-items">
          <view class="day-cell level-0"></view>
          <view class="day-cell level-1"></view>
          <view class="day-cell level-2"></view>
          <view class="day-cell level-3"></view>
          <view class="day-cell level-4"></view>
        </view>
        <text class="legend-text">More</text>
      </view>
    </view>

    <!-- Actions -->
    <view class="section-actions">
      <button class="btn-primary" bindtap="startFocus">开始专注</button>
      <button class="btn-secondary" bindtap="editGoal">编辑目标</button>
    </view>

    <!-- Footer Padding -->
    <view style="height: 40px;"></view>

  </scroll-view>
</view>
